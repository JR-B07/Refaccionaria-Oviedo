# Visual Guide - Nuevo Cierre de Caja

## ğŸ“± Vista 1: Lista de Cierres (cajas_cierre.html)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ REFACCIONARIA - ACCESO RAPIDO                  Usuario: Admin   â”‚
â”‚                                               [Cerrar SesiÃ³n]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚
â”‚ Cajas > Cierres de Caja
â”‚
â”‚ Lista de cierres de caja
â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”‚ Sucursal: REFACCIONARIA OVIEDO    [â• Nuevo Cierre]      â”‚  â† NUEVO
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â”‚ â”Œâ”€ Filtros â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”‚ Caja: [____]  Fechas: [__/__/__] a [__/__/__]  Vendedor: [_] â”‚
â”‚ â”‚                                              [Buscar]         â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â”‚ â”Œâ”€ Resultados â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”‚ CAJA   | VENDEDOR             | APERTURA    | CIERRE    [Menu]â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”‚VENTAS01â”‚ REINALDO OVIEDO      â”‚ 05/01/2026  â”‚ 05/01/2026      â”‚
â”‚ â”‚        â”‚ CALIXTRO             â”‚ 09:12       â”‚ 18:20           â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‹ Vista 2: Formulario Nuevo Cierre (cierre_caja_nuevo.html) - NUEVO

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [â† Volver]  Nuevo Cierre de Caja          Usuario: REINALDO     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚
â”‚ â”Œâ”€ Datos del Cierre â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”‚ Caja: [VENTAS01]          Fecha/Hora: 15/01/2026  10:30:45  â”‚
â”‚ â”‚ Vendedor: REINALDO OVIEDO CALIXTRO                            â”‚
â”‚ â”‚ Sucursal: REFACCIONARIA OVIEDO                                â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â”‚ â”Œâ”€ Seleccione opciones correspondientes a su cierre â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”‚ Formas de Pago:                                               â”‚
â”‚ â”‚ â˜‘ Efectivo  [        1000.00]  â”‚  â˜‘ CrÃ©dito   [         500] â”‚
â”‚ â”‚ â˜ Cheque    [                ]  â”‚  â˜ Vale      [             â”‚
â”‚ â”‚ â˜ Tarjeta   [                ]  â”‚  â˜ Lealtad   [             â”‚
â”‚ â”‚ â˜ DÃ©bito    [                ]  â”‚  â˜ Retiros   [         200] â”‚
â”‚ â”‚ â˜ DepÃ³sito  [                ]  â”‚                             â”‚
â”‚ â”‚                                                                â”‚
â”‚ â”‚ Total ingresos (sin retiros):               $1,500.00         â”‚
â”‚ â”‚ Total cierre (ingresos - retiros):          $1,300.00         â”‚
â”‚ â”‚                                                                â”‚
â”‚ â”‚ Solo se consideran los conceptos marcados.                    â”‚
â”‚ â”‚ El total se actualiza automÃ¡ticamente.                        â”‚
â”‚ â”‚                                                                â”‚
â”‚ â”‚                           [Cancelar]  [Procesar] â†â”€ GUARDAR   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Flujo de InteracciÃ³n

```
User en cajas_cierre.html
           â”‚
           â””â”€â†’ Clic en "â• Nuevo Cierre"
                      â”‚
                      â†“
           Abre cierre_caja_nuevo.html
                      â”‚
                      â”œâ”€â†’ Auto-carga datos del usuario:
                      â”‚   - Fecha/Hora actual
                      â”‚   - Vendedor (from localStorage)
                      â”‚   - Sucursal (from localStorage)
                      â”‚
                      â”œâ”€â†’ Usuario marca checkboxes y
                      â”‚   ingresa montos
                      â”‚   â”‚
                      â”‚   â””â”€â†’ JavaScript recalcula:
                      â”‚       - total_ingresos
                      â”‚       - total_cierre
                      â”‚
                      â””â”€â†’ Clic en "Procesar"
                           â”‚
                           â†“
                POST /api/v1/cajas/cierres
                (JSON con montos)
                           â”‚
                           â†“
                Backend calcula totales
                Guarda en BD cierres_caja
                           â”‚
                           â†“
                Alert: "Cierre creado. Folio: 42"
                           â”‚
                           â†“
                Redirige a cajas_cierre.html
```

## ğŸ“Š Estructura de Datos Guardados

```
Tabla: cierres_caja

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id     â”‚ caja     â”‚ usuario_id â”‚ efectivoâ”‚ cheque  â”‚ credito  â”‚ retiros    â”‚ total_cierre â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1      â”‚ VENTAS01 â”‚ 5          â”‚ 1000.00â”‚ 0.00    â”‚ 500.00   â”‚ 200.00     â”‚ 1300.00      â”‚
â”‚ 2      â”‚ VENTAS02 â”‚ 6          â”‚ 2500.00â”‚ 1000.00 â”‚ 0.00     â”‚ 0.00       â”‚ 3500.00      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Total de 9 campos de montos:
  - efectivo, cheque, tarjeta, debito, deposito
  - credito, vale, lealtad, retiros
  
Campos calculados automÃ¡ticamente:
  - total_ingresos = efectivo + cheque + tarjeta + debito + deposito + credito + vale + lealtad
  - total_cierre = total_ingresos - retiros
```

## ğŸ¯ CaracterÃ­sticas

âœ… **Interfaz Intuitiva**
   - DiseÃ±o similar a la imagen proporcionada
   - Botones claramente identificados
   - Fecha/hora automÃ¡ticas
   - Datos del usuario precargados

âœ… **CÃ¡lculos AutomÃ¡ticos**
   - En tiempo real mientras se ingresan montos
   - RecÃ¡lculo al marcar/desmarcar checkboxes
   - ValidaciÃ³n en backend (no se confÃ­a en cliente)

âœ… **Seguridad**
   - Requiere autenticaciÃ³n (token)
   - Datos del usuario obtenidos del sistema
   - Transacciones garantizadas

âœ… **IntegraciÃ³n**
   - Parte del menÃº principal
   - Navega correctamente
   - URLs limpias y semÃ¡nticas

---

## ğŸš€ URLs Principales

| PÃ¡gina | URL |
|--------|-----|
| Cierres de Caja | `/static/cajas_cierre.html` |
| Nuevo Cierre | `/static/cierre_caja_nuevo.html` |
| Ruta del menÃº | `/cajas-cierre` |
| API endpoint | `POST /api/v1/cajas/cierres` |

---

## ğŸ’¾ Persistencia

- **Tabla BD**: `cierres_caja`
- **Modelo**: `app.models.cierre_caja.CierreCaja`
- **AutomÃ¡tico**: La tabla se crea al iniciar la aplicaciÃ³n
- **Schema Maestro**: `../refaccionaria_db.sql` (archivo consolidado)
